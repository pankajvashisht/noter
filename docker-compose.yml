version: "3"
services:
  noter:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        BUILD: local
        PORT: 80
    ports:
      - 8084:80
    volumes:
      - .:/var/www/html
    depends_on:
      - mysql
      - mysql_tdd
    environment:
      APP_DEBUG: 'true'
      APP_ENV: 'local'
      APP_KEY: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      APP_URL: https://202.105.1.1
      BUILD: local
      DATABASE_URL: mysql://user:password@mysql/noter
      DATABASE_URL_TDD: mysql://user:password@mysql_tdd/noter
      QUEUE_CONNECTION: database
      TELESCOPE_URL: mysql://user:password@mysql/noter
    networks:
      noter_api:
        ipv4_address: 202.105.1.1

  mysql:
    image: mysql:latest
    ports:
      - 9906:3306
    volumes:
      - db_data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: docker
      MYSQL_DATABASE: noter
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    networks:
      noter_api:
        ipv4_address: 202.105.1.2

  mysql_tdd:
    image: mysql:latest
    ports:
      - 9916:3306
    volumes:
      - db_data_tdd:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: docker
      MYSQL_DATABASE: noter
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    networks:
      noter_api:
        ipv4_address: 202.105.1.3


volumes:
  db_data: { }
  db_data_tdd: { }
networks:
  noter_api:
    ipam:
      driver: default
      config:
        - subnet: 202.105.0.0/16
